pipeline {
    agent none
    stages {
        stage('Python Stage') {
            agent {
            docker {
                image 'python:3.11'
                args '--user root'
            }
            }
            steps {
            script {
                sh 'python -m venv venv'
                sh '. venv/bin/activate'  // Active l'environnement virtuel
                sh 'pip install --upgrade pip' 
                sh 'pip install -r requirements.txt'  
                sh 'ls -l scripts'  // Liste les fichiers pour vérifier que Dataprep.py est là
                sh 'python lib/list.py'  // Ou 'python3' si nécessaire
                stash includes: 'data/data.csv', name: 'data_csv'
            }
            }
        }
        stage('Newman Stage') {
            agent {
                docker {
                    image 'postman/newman:alpine'
                    args "--entrypoint=''"
                }
            }
            steps {
                script {
                    unstash 'data_csv'
                    sh 'newman run collection/register_collection.json -e collection/env.json -d data/data.csv'
                }
            }
        }
    }
}
